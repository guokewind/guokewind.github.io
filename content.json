[{"title":"","date":"2017-03-28T18:47:58.626Z","path":"2017/03/29/更换vps_170329024758/","text":"更换vps.md—E:\\ideawk\\blog\\source\\_posts html{font-family: sans-serif;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%}body{margin: 0}article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display: block}audio,canvas,progress,video{display: inline-block;vertical-align: baseline}audio:not([controls]){display: none;height: 0}[hidden],template{display: none}a{background: transparent}a:active,a:hover{outline: 0}abbr[title]{border-bottom: 1px dotted}b,strong{font-weight: bold}dfn{font-style: italic}h1{font-size: 2em;margin: 0.67em 0}mark{background: #ff0;color: #000}small{font-size: 80%}sub,sup{font-size: 75%;line-height: 0;position: relative;vertical-align: baseline}sup{top: -0.5em}sub{bottom: -0.25em}img{border: 0}svg:not(:root){overflow: hidden}figure{margin: 1em 40px}hr{box-sizing: content-box;height: 0}pre{overflow: auto}code,kbd,pre,samp{font-family: monospace, monospace;font-size: 1em}button,input,optgroup,select,textarea{color: inherit;font: inherit;margin: 0}button{overflow: visible}button,select{text-transform: none}button,html input[type=\"button\"],input[type=\"reset\"],input[type=\"submit\"]{-webkit-appearance: button;cursor: pointer}button[disabled],html input[disabled]{cursor: default}button::-moz-focus-inner,input::-moz-focus-inner{border: 0;padding: 0}input{line-height: normal}input[type=\"checkbox\"],input[type=\"radio\"]{box-sizing: border-box;padding: 0}input[type=\"number\"]::-webkit-inner-spin-button,input[type=\"number\"]::-webkit-outer-spin-button{height: auto}input[type=\"search\"]{-webkit-appearance: textfield;box-sizing: content-box}input[type=\"search\"]::-webkit-search-cancel-button,input[type=\"search\"]::-webkit-search-decoration{-webkit-appearance: none}fieldset{border: 1px solid #c0c0c0;margin: 0 2px;padding: 0.35em 0.625em 0.75em}legend{border: 0;padding: 0}textarea{overflow: auto}optgroup{font-weight: bold}table{border-collapse: collapse;border-spacing: 0}td,th{padding: 0}*{box-sizing: border-box}input,select,textarea,button{font: 13px/1.4 Helvetica, arial, freesans, clean, sans-serif, \"Segoe UI Emoji\", \"Segoe UI Symbol\"}body{min-width: 1020px;font: 13px/1.4 Helvetica, arial, freesans, clean, sans-serif, \"Segoe UI Emoji\", \"Segoe UI Symbol\";color: #333;background-color: #fff}a{color: #4183c4;text-decoration: none}a:hover,a:active{text-decoration: underline}hr,.rule{height: 0;margin: 15px 0;overflow: hidden;background: transparent;border: 0;border-bottom: 1px solid #ddd}hr:before,.rule:before{display: table;content: \"\"}hr:after,.rule:after{display: table;clear: both;content: \"\"}h1,h2,h3,h4,h5,h6{margin-top: 15px;margin-bottom: 15px;line-height: 1.1}h1{font-size: 30px}h2{font-size: 21px}h3{font-size: 16px}h4{font-size: 14px}h5{font-size: 12px}h6{font-size: 11px}small{font-size: 90%}blockquote{margin: 0}.lead{margin-bottom: 30px;font-size: 20px;font-weight: 300;color: #555}.text-muted{color: #999}.text-danger{color: #bd2c00}.text-emphasized{font-weight: bold;color: #333}ul,ol{padding: 0;margin-top: 0;margin-bottom: 0}ol ol,ul ol{list-style-type: lower-roman}ul ul ol,ul ol ol,ol ul ol,ol ol ol{list-style-type: lower-alpha}dd{margin-left: 0}tt,code{font-family: Consolas, \"Liberation Mono\", Menlo, Courier, monospace;font-size: 12px}pre{margin-top: 0;margin-bottom: 0;font: 12px Consolas, \"Liberation Mono\", Menlo, Courier, monospace}#realtime .status{overflow: visible;position: absolute;top: -5px;left: 0;background: url(\"/public/images/github-status.png\");width: 26px;height: 26px;display: block;margin: 0 5px 0 0}#realtime .up{background-position: 0 0}#realtime .problem{background-position: 0 -53px}#realtime .down{background-position: 0 -26px}.container{max-width: 920px;margin: 0 auto 20px auto}#header{background: #FAFAFA;background: -moz-linear-gradient(#FAFAFA, #EAEAEA);background: -webkit-linear-gradient(#FAFAFA, #EAEAEA);-ms-filter: \"progid:DXImageTransform.Microsoft.gradient(startColorstr='#fafafa', endColorstr='#eaeaea')\";border-bottom: 1px solid #CACACA;box-shadow: 0 1px 0 rgba(255, 255, 255, 0.4),0 0 10px rgba(0, 0, 0, 0.1)}#markup{padding: 3px}#markup article{padding-top: 30px}.markdown-body{overflow: hidden;font-family: \"Helvetica Neue\", Helvetica, \"Segoe UI\", Arial, freesans, sans-serif;font-size: 16px;line-height: 1.6;word-wrap: break-word}.markdown-body>*:first-child{margin-top: 0 !important}.markdown-body>*:last-child{margin-bottom: 0 !important}.markdown-body .absent{color: #c00}.markdown-body .anchor{position: absolute;top: 0;left: 0;display: block;padding-right: 6px;padding-left: 30px;margin-left: -30px}.markdown-body .anchor:focus{outline: none}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position: relative;margin-top: 1em;margin-bottom: 16px;font-weight: bold;line-height: 1.4}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{display: none;color: #000;vertical-align: middle}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{padding-left: 8px;margin-left: -30px;text-decoration: none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{display: inline-block}.markdown-body h1 tt,.markdown-body h1 code,.markdown-body h2 tt,.markdown-body h2 code,.markdown-body h3 tt,.markdown-body h3 code,.markdown-body h4 tt,.markdown-body h4 code,.markdown-body h5 tt,.markdown-body h5 code,.markdown-body h6 tt,.markdown-body h6 code{font-size: inherit}.markdown-body h1{padding-bottom: 0.3em;font-size: 2.25em;line-height: 1.2;border-bottom: 1px solid #eee}.markdown-body h1 .anchor{line-height: 1}.markdown-body h2{padding-bottom: 0.3em;font-size: 1.75em;line-height: 1.225;border-bottom: 1px solid #eee}.markdown-body h2 .anchor{line-height: 1}.markdown-body h3{font-size: 1.5em;line-height: 1.43}.markdown-body h3 .anchor{line-height: 1.2}.markdown-body h4{font-size: 1.25em}.markdown-body h4 .anchor{line-height: 1.2}.markdown-body h5{font-size: 1em}.markdown-body h5 .anchor{line-height: 1.1}.markdown-body h6{font-size: 1em;color: #777}.markdown-body h6 .anchor{line-height: 1.1}.markdown-body p,.markdown-body blockquote,.markdown-body ul,.markdown-body ol,.markdown-body dl,.markdown-body table,.markdown-body pre{margin-top: 0;margin-bottom: 16px}.markdown-body hr{height: 4px;padding: 0;margin: 16px 0;background-color: #e7e7e7;border: 0 none}.markdown-body ul,.markdown-body ol{padding-left: 2em}.markdown-body ul.no-list,.markdown-body ol.no-list{padding: 0;list-style-type: none}.markdown-body ul ul,.markdown-body ul ol,.markdown-body ol ol,.markdown-body ol ul{margin-top: 0;margin-bottom: 0}.markdown-body li>p{margin-top: 16px}.markdown-body dl{padding: 0}.markdown-body dl dt{padding: 0;margin-top: 16px;font-size: 1em;font-style: italic;font-weight: bold}.markdown-body dl dd{padding: 0 16px;margin-bottom: 16px}.markdown-body blockquote{padding: 0 15px;color: #777;border-left: 4px solid #ddd}.markdown-body blockquote>:first-child{margin-top: 0}.markdown-body blockquote>:last-child{margin-bottom: 0}.markdown-body table{display: block;width: 100%;overflow: auto;word-break: normal;word-break: keep-all}.markdown-body table th{font-weight: bold}.markdown-body table th,.markdown-body table td{padding: 6px 13px;border: 1px solid #ddd}.markdown-body table tr{background-color: #fff;border-top: 1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color: #f8f8f8}.markdown-body img{max-width: 100%;box-sizing: border-box}.markdown-body span.frame{display: block;overflow: hidden}.markdown-body span.frame>span{display: block;float: left;width: auto;padding: 7px;margin: 13px 0 0;overflow: hidden;border: 1px solid #ddd}.markdown-body span.frame span img{display: block;float: left}.markdown-body span.frame span span{display: block;padding: 5px 0 0;clear: both;color: #333}.markdown-body span.align-center{display: block;overflow: hidden;clear: both}.markdown-body span.align-center>span{display: block;margin: 13px auto 0;overflow: hidden;text-align: center}.markdown-body span.align-center span img{margin: 0 auto;text-align: center}.markdown-body span.align-right{display: block;overflow: hidden;clear: both}.markdown-body span.align-right>span{display: block;margin: 13px 0 0;overflow: hidden;text-align: right}.markdown-body span.align-right span img{margin: 0;text-align: right}.markdown-body span.float-left{display: block;float: left;margin-right: 13px;overflow: hidden}.markdown-body span.float-left span{margin: 13px 0 0}.markdown-body span.float-right{display: block;float: right;margin-left: 13px;overflow: hidden}.markdown-body span.float-right>span{display: block;margin: 13px auto 0;overflow: hidden;text-align: right}.markdown-body code,.markdown-body tt{padding: 0;padding-top: 0.2em;padding-bottom: 0.2em;margin: 0;font-size: 85%;background-color: rgba(0,0,0,0.04);border-radius: 3px}.markdown-body code:before,.markdown-body code:after,.markdown-body tt:before,.markdown-body tt:after{letter-spacing: -0.2em;content: \"\\00a0\"}.markdown-body code br,.markdown-body tt br{display: none}.markdown-body del code{text-decoration: inherit}.markdown-body pre>code{padding: 0;margin: 0;font-size: 100%;word-break: normal;white-space: pre;background: transparent;border: 0}.markdown-body .highlight{margin-bottom: 16px}.markdown-body .highlight pre,.markdown-body pre{padding: 16px;overflow: auto;font-size: 85%;line-height: 1.45;background-color: #f7f7f7;border-radius: 3px}.markdown-body .highlight pre{margin-bottom: 0;word-break: normal}.markdown-body pre{word-wrap: normal}.markdown-body pre code,.markdown-body pre tt{display: inline;max-width: initial;padding: 0;margin: 0;overflow: initial;line-height: inherit;word-wrap: normal;background-color: transparent;border: 0}.markdown-body pre code:before,.markdown-body pre code:after,.markdown-body pre tt:before,.markdown-body pre tt:after{content: normal}.markdown-body kbd{display: inline-block;padding: 3px 5px;font-size: 11px;line-height: 10px;color: #555;vertical-align: middle;background-color: #fcfcfc;border: solid 1px #ccc;border-bottom-color: #bbb;border-radius: 3px;box-shadow: inset 0 -1px 0 #bbb}.codehilite{background: #ffffff}.codehilite .c{color: #999988;font-style: italic}.codehilite .err{color: #a61717;background-color: #e3d2d2}.codehilite .k{color: #000000;font-weight: bold}.codehilite .o{color: #000000;font-weight: bold}.codehilite .cm{color: #999988;font-style: italic}.codehilite .cp{color: #999999;font-weight: bold}.codehilite .c1{color: #999988;font-style: italic}.codehilite .cs{color: #999999;font-weight: bold;font-style: italic}.codehilite .gd{color: #000000;background-color: #ffdddd}.codehilite .gd .x{color: #000000;background-color: #ffaaaa}.codehilite .ge{color: #000000;font-style: italic}.codehilite .gr{color: #aa0000}.codehilite .gh{color: #999999}.codehilite .gi{color: #000000;background-color: #ddffdd}.codehilite .gi .x{color: #000000;background-color: #aaffaa}.codehilite .go{color: #888888}.codehilite .gp{color: #555555}.codehilite .gs{font-weight: bold}.codehilite .gu{color: #aaaaaa}.codehilite .gt{color: #aa0000}.codehilite .kc{color: #000000;font-weight: bold}.codehilite .kd{color: #000000;font-weight: bold}.codehilite .kp{color: #000000;font-weight: bold}.codehilite .kr{color: #000000;font-weight: bold}.codehilite .kt{color: #445588;font-weight: bold}.codehilite .m{color: #009999}.codehilite .s{color: #d14}.codehilite .na{color: #008080}.codehilite .nb{color: #0086B3}.codehilite .nc{color: #445588;font-weight: bold}.codehilite .no{color: #008080}.codehilite .ni{color: #800080}.codehilite .ne{color: #990000;font-weight: bold}.codehilite .nf{color: #990000;font-weight: bold}.codehilite .nn{color: #555555}.codehilite .nt{color: #000080}.codehilite .nv{color: #008080}.codehilite .ow{color: #000000;font-weight: bold}.codehilite .w{color: #bbbbbb}.codehilite .mf{color: #009999}.codehilite .mh{color: #009999}.codehilite .mi{color: #009999}.codehilite .mo{color: #009999}.codehilite .sb{color: #d14}.codehilite .sc{color: #d14}.codehilite .sd{color: #d14}.codehilite .s2{color: #d14}.codehilite .se{color: #d14}.codehilite .sh{color: #d14}.codehilite .si{color: #d14}.codehilite .sx{color: #d14}.codehilite .sr{color: #009926}.codehilite .s1{color: #d14}.codehilite .ss{color: #990073}.codehilite .bp{color: #999999}.codehilite .vc{color: #008080}.codehilite .vg{color: #008080}.codehilite .vi{color: #008080}.codehilite .il{color: #009999} .markdown-body hr{background:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC\")} 成文时间：2017-03-22 01:31:00 更新时间：2017-03-29 最近vultr有2.5美元一个月，还有活动，配置也不错。准备转移到vultr。 长期有效的邀请链接。 还是用搬瓦工,顺便广告：kvm,28$包年,512内存,目前4机房 , 19$包年,512mb内存，1机房,稳定好用。 优惠码：IAMSMART5Q74B8（节省4.77%） 安装的是centos7,之前用的centos6，有些不同。记录下我的服务器配置 在确认配置好之前，先别关闭ssh，新开一个终端测试 SSH 更换端口 用下面命令进入配置文件。 vi /etc/ssh/sshd_config 找到#port 22，将前面的#去掉，然后修改端口 port 20001（自己设定） 建议先添加新端口，待新端口可以连接后再去掉22端口 然后重启ssh服务。 service sshd restart 开放20001端口 firewall-cmd --zone=public --add-port=20001/tcp --permanent 如果是iptables，第一次配置先 iptables -F //清除所有的已订定的规则，如果清空后连不上，可能是预设规则为DROP，可通过iptable -nL查看 新建一个用户代替root //添加一个名为tommy的用户 adduser tommy passwd tommy //修改密码 获得root 权限： 修改 /etc/sudoers 文件，找到下面一行，在root下面添加一行，如下所示： ##Allow root to run any commands anywhere root ALL=(ALL) ALL tommy ALL=(ALL) ALL 修改完毕，现在可以用tommy帐号登录，然后用命令 su - ，即可获得root权限进行操作。 使用密钥登录 使用xshell-工具-新建用户密钥生成向导,一直下一步，保存生成的公钥，私钥。把公钥复制保存到Linux服务器的authorized_keys文件里面。 需要把该信息拷贝到Linux服务器的特定文件中：~/.ssh/authroized_keys 其中，“~”表示对应用户的主目录，以tommy为例。 若.ssh目录不存在，请创建它，并把公钥信息写入文件中： mkdir ~/.ssh chmod 700 ~/.ssh vi ~/.ssh/authorized_keys chmod 600 ~/.ssh/authorized_keys 请务必留意：文件和目录的权限问题，用户必须是将要进行认证的用户，而权限必须是0644，也就是禁止其他人对该文件写入信息。（否则，某些有心人把自己的公钥写入这里，他也可以无密码进来了） 因为，通常umask是0022或0002的，所以请使用chown和chmod修改为对应的权限咯。 基于密钥认证的配置 由于这里是tommy在操作，所以需要获取权限才能操作 sudo vi /etc/ssh/sshd_config 修改为 PasswordAuthentication no //禁止使用基于口令认证的方式登陆 PubkeyAuthentication yes //允许使用基于密钥认证的方式登陆 重启ssh sudo service sshd restart 如果失败，可尝试kill -9 [sshd的pid] 然后 sudo service sshd start 尝试登录，只能使用密匙登录。 用密匙登录，提示没有注册该密匙。 多次检查配置后，没有问题。查看/var/log/secure 提示 Authentication refused: bad ownership or modes for directory /home/tommy/.ssh 得知是权限设置错了 SSH doesn’t like it if your home or ~/.ssh directories have group write permissions. Your home directory should be writable only by you, ~/.ssh should be 700, and authorized_keys should be 600 You can also get around this by adding StrictModes off to your ssh_config file, but I’d advise against it - fixing permissions is the way to go. 所以一定要改成： chmod 700 ~/.ssh chmod 600 ~/.ssh/authorized_keys 重启sshsudo service sshd start ,成功登录。 已经可以用tommy登录了，所以可以不允许root用户登录了: sudo vi /etc/ssh/sshd_config 修改为 PermitRootLogin no 今天就到这里了。。 继续配置iptables 只允许每个ip同时5个80端口转发,超过的丢弃 iptables -I FORWARD -p tcp --syn --dport 80 -m connlimit --connlimit-above 5 -j DROP 拒绝其他所有协议 不太清楚最好别运行。 iptables -A INPUT -j REJECT //!!在运行此规则之前先确保ssh端口已经生效（service iptables restart） 如果已经运行又断开了连接，试着重启一下服务器，只要没永久生效那么还能连上。","tags":[]},{"title":" 更换vps","date":"2017-03-21T17:38:17.000Z","path":"2017/03/22/更换vps/","text":"成文时间：2017-03-22 01:31:00更新时间：2017-03-29最近vultr有2.5美元一个月，还有活动，配置也不错。准备转移到vultr。长期有效的邀请链接。还是用搬瓦工,顺便广告：kvm,28$包年,512内存,目前4机房 , 19$包年,512mb内存，1机房,稳定好用。优惠码：IAMSMART5Q74B8（节省4.77%） 安装的是centos7,之前用的centos6，有些不同。记录下我的服务器配置 在确认配置好之前，先别关闭ssh，新开一个终端测试 SSH 更换端口用下面命令进入配置文件。 vi /etc/ssh/sshd_config 找到#port 22，将前面的#去掉，然后修改端口 port 20001（自己设定）建议先添加新端口，待新端口可以连接后再去掉22端口 然后重启ssh服务。 service sshd restart 开放20001端口 firewall-cmd --zone=public --add-port=20001/tcp --permanent 如果是iptables，第一次配置先 iptables -F //清除所有的已订定的规则，如果清空后连不上，可能是预设规则为DROP，可通过iptable -nL查看 新建一个用户代替root//添加一个名为tommy的用户 adduser tommy passwd tommy //修改密码 获得root 权限： 修改 /etc/sudoers 文件，找到下面一行，在root下面添加一行，如下所示： ##Allow root to run any commands anywhere root ALL=(ALL) ALL tommy ALL=(ALL) ALL 修改完毕，现在可以用tommy帐号登录，然后用命令 su - ，即可获得root权限进行操作。 使用密钥登录使用xshell-工具-新建用户密钥生成向导,一直下一步，保存生成的公钥，私钥。把公钥复制保存到Linux服务器的authorized_keys文件里面。 需要把该信息拷贝到Linux服务器的特定文件中：~/.ssh/authroized_keys其中，“~”表示对应用户的主目录，以tommy为例。若.ssh目录不存在，请创建它，并把公钥信息写入文件中： mkdir ~/.ssh chmod 700 ~/.ssh vi ~/.ssh/authorized_keys chmod 600 ~/.ssh/authorized_keys 请务必留意：文件和目录的权限问题，用户必须是将要进行认证的用户，而权限必须是0644，也就是禁止其他人对该文件写入信息。（否则，某些有心人把自己的公钥写入这里，他也可以无密码进来了）因为，通常umask是0022或0002的，所以请使用chown和chmod修改为对应的权限咯。 基于密钥认证的配置由于这里是tommy在操作，所以需要获取权限才能操作 sudo vi /etc/ssh/sshd_config 修改为 PasswordAuthentication no //禁止使用基于口令认证的方式登陆 PubkeyAuthentication yes //允许使用基于密钥认证的方式登陆 重启ssh sudo service sshd restart 如果失败，可尝试kill -9 [sshd的pid]然后 sudo service sshd start 尝试登录，只能使用密匙登录。 用密匙登录，提示没有注册该密匙。 多次检查配置后，没有问题。查看/var/log/secure提示 Authentication refused: bad ownership or modes for directory /home/tommy/.ssh得知是权限设置错了 SSH doesn’t like it if your home or ~/.ssh directories have group write permissions. Your home directory should be writable only by you, ~/.ssh should be 700, and authorized_keys should be 600You can also get around this by adding StrictModes off to your ssh_config file, but I’d advise against it - fixing permissions is the way to go. 所以一定要改成： chmod 700 ~/.ssh chmod 600 ~/.ssh/authorized_keys 重启sshsudo service sshd start ,成功登录。 已经可以用tommy登录了，所以可以不允许root用户登录了: sudo vi /etc/ssh/sshd_config 修改为 PermitRootLogin no 今天就到这里了。。 继续配置iptables 只允许每个ip同时5个80端口转发,超过的丢弃 iptables -I FORWARD -p tcp --syn --dport 80 -m connlimit --connlimit-above 5 -j DROP 拒绝其他所有协议 不太清楚最好别运行。 iptables -A INPUT -j REJECT //!!在运行此规则之前先确保ssh端口已经生效（service iptables restart） 如果已经运行又断开了连接，试着重启一下服务器，只要没永久生效那么还能连上。","tags":[{"name":"vps","slug":"vps","permalink":"http://yoursite.com/tags/vps/"},{"name":"搬瓦工","slug":"搬瓦工","permalink":"http://yoursite.com/tags/搬瓦工/"},{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"vultr","slug":"vultr","permalink":"http://yoursite.com/tags/vultr/"},{"name":"centos","slug":"centos","permalink":"http://yoursite.com/tags/centos/"}]},{"title":"使用https","date":"2017-02-16T17:24:04.000Z","path":"2017/02/17/使用https/","text":"成文时间: 2017年2月17日 01:25:15 使用https看到访问地址，好像缺点什么。htpps，就是它。 在阿里云上申请了一年的免费SSL证书，需要在服务器特定路径上传一个文件用以验证。这里引用了阿里云的安装介绍。 ( 1 ) 在Nginx的安装目录下创建cert目录，并且将下载的全部文件拷贝到cert目录中。如果申请证书时是自己创建的CSR文件，请将对应的私钥文件放到cert目录下并且命名为cert.key； ( 2 ) 打开 Nginx 安装目录下 conf 目录中的 nginx.conf 文件，找到： server { listen 443; server_name localhost; ssl on; ssl_certificate cert.pem; ssl_certificate_key cert.key; ssl_session_timeout 5m; ssl_protocols SSLv2 SSLv3 TLSv1; ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP; ssl_prefer_server_ciphers on; location / { root html } } ( 3 ) 将其修改为 (以下属性中ssl开头的属性与证书配置有直接关系，其它属性请结合自己的实际情况复制或调整) : 保存退出。 ( 4 )重启 Nginx。 ( 5 ) 通过 https 方式访问您的站点，测试站点证书的安装配置。 也可以不新开一个server， 直接在之前的server上 server { listen 80; listen 443 ssl; server_name localhost; ssl_certificate cert.pem; ssl_certificate_key cert.key; ssl_session_timeout 5m; ssl_protocols SSLv2 SSLv3 TLSv1; ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP; ssl_prefer_server_ciphers on; location / { root html } #这样可以强制https if ($scheme = http ) { return 301 https://$host$request_uri; } } 启动后，访问报错了。查询后发现是用了SSL却没有安装http_ssl_module模块，但http_ssl_module并不属于nginx的基本模块所以自己重新编译添加。 1.首先看下内核和系统的版本号。[root@zabbix ~]# uname -aLinux zabbix.nnkj.com 2.6.32-573.el6.x86_64 #1 SMP Thu Jul 23 15:44:03 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux[root@zabbix ~]# cat /etc/issueCentOS release 6.7 (Final)Kernel \\r on an \\m 2.看下编译安装nginx的时候，都编译安装的哪些模块。[root@zabbix ~]# /usr/local/nginx/sbin/nginx -Vnginx version: nginx/1.8.0built by gcc 4.4.7 20120313 (Red Hat 4.4.7-17) (GCC)built with OpenSSL 1.0.1e-fips 11 Feb 2013TLS SNI support enabledconfigure arguments: –prefix=/usr/local/nginx 3.进入之前下载并解压了的源码包目录；重新编译nginx注意- –prefix=PATH: 指定nginx的安装目录 ，这里要指定为之前的prefix[root@zabbix nginx-1.8.0]# cd /usr/local/src/nginx-1.8.0[root@zabbix nginx-1.8.0]# ./configure –prefix=/usr/local/nginx –with-http_stub_status_module –with-http_ssl_module[root@zabbix nginx-1.8.0]# make▲这一步千万不能 make install ；不然会把之前已经安装的nginx 覆盖掉 4.需要替换nginx二进制文件,先停止掉nginx进程；备份一下原来的启动脚本。[root@zabbix nginx-1.8.0]# /etc/init.d/nginx stop[root@zabbix nginx-1.8.0]# cp /etc/init.d/nginx /etc/init.d/nginx.bak [root@zabbix nginx-1.8.0]# cp objs/nginx /usr/local/nginx/sbin/cp: overwrite `/usr/local/nginx/sbin/nginx’? yes 5.查看nginx的模块，看下是否把需要的模块编译进去了 参考:http://www.itnpc.com/news/web/146771636486934.html 重启后，访问成功了，不过我这里提示有不受信任的资源，应该是引用了不少外部链接的原因吧。对了，我的地址。","tags":[{"name":"nginx","slug":"nginx","permalink":"http://yoursite.com/tags/nginx/"},{"name":"https","slug":"https","permalink":"http://yoursite.com/tags/https/"},{"name":"ssl","slug":"ssl","permalink":"http://yoursite.com/tags/ssl/"}]},{"title":"博客优化","date":"2017-02-14T17:15:30.000Z","path":"2017/02/15/博客优化/","text":"更新时间:2017年2月15日01:35:18 使用多说我使用的是yilia。 在_config.yml中添加多说的配置： duoshuo: 你站点的short_name 修改themes\\landscape\\layout\\_partial\\article.ejs 把&lt;section id=&quot;comments&quot;&gt;&lt;/section&gt;之间的代码换成多说的通用代码。 参考 一个人难免无聊，不知道谁会是我第一个评论者。","tags":[{"name":"hexo","slug":"hexo","permalink":"http://yoursite.com/tags/hexo/"}]},{"title":" hexo中插入音乐","date":"2017-02-13T17:24:49.000Z","path":"2017/02/14/在hexo-yilia中使用网易云/","text":"前言从用QQ空间开始就喜欢插入背景音乐，如今自己管理自己的博客，当然也要插入音乐，不用开绿钻哈哈哈哈。 关于主题我用的是yilia。 添加音乐添加的网易云音乐，很方便。打开网易云音乐某首歌详情页，点击生成外链播放器，选择iframe插件。选择好尺寸。复制html代码。如：1&lt;iframe frameborder=&quot;no&quot; border=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; width=298 height=52 src=&quot;//music.163.com/outchain/player?type=2&amp;id=4940455&amp;auto=1&amp;height=32&quot;&gt;&lt;/iframe&gt; 这里手动修改width为”100%”,再添上class。然后把下面这段代码复制到themes\\yilia\\layout\\_partial\\left-col.ejs里，代码： 123&lt;nav class=\"header-music\"&gt;&lt;iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" width=298 height=52 src=\"//music.163.com/outchain/player?type=2&amp;id=4940455&amp;auto=1&amp;height=32\"&gt;&lt;/iframe&gt;&lt;/nav&gt; 如图: 。这样就可以生成播放器了，但是还需要调一下css样式。在themes\\yilia\\source\\main.2d7529.css(如果名字不同，也应为main.xx.css)末尾添加1.header-music &#123;margin-top: 80px; &#125; 接着hexo clean,hexo g,hexo s 搞定。效果如下： 之后会试着利用cplayer把列表插入到主题中。","tags":[{"name":"hexo","slug":"hexo","permalink":"http://yoursite.com/tags/hexo/"}]},{"title":"阿里巴巴Java规约学习-foreach","date":"2017-02-13T16:21:13.000Z","path":"2017/02/14/阿里巴巴Java规约学习-foreach/","text":"7. 【强制】不要在 foreach 循环里进行元素的 remove / add 操作。 remove 元素请使用 Iterator 方式，如果并发操作，需要对 Iterator 对象加锁。 反例： List&lt;String&gt; a = new ArrayList&lt;String&gt;(); a.add(&quot;1&quot;); a.add(&quot;2&quot;); for (String temp : a) { if(&quot;1&quot;.equals(temp)){ a.remove(temp); } } 说明：以上代码的执行结果肯定会出乎大家的意料，那么试一下把“1”换成“2”，会是同样的 结果吗？ 正例： Iterator&lt;String&gt; it = a.iterator(); while(it.hasNext()){ String temp = it.next(); if(删除元素的条件){ it.remove(); } } 先看看输出结果: 123456789101112131415161718192021222324252627public class Test &#123; public static void main(String[] args) &#123; List&lt;String&gt; a = new ArrayList&lt;String&gt;(); a.add(\"1\"); a.add(\"2\");// for (String temp : a) &#123;// if (\"1\".equals(temp)) &#123;// a.remove(temp);//正常// &#125;// &#125; // for (String temp : a) &#123;// java.util.ConcurrentModificationException at java.util.ArrayList$Itr.checkForComodification(ArrayList.java:859) at java.util.ArrayList$Itr.next(ArrayList.java:831)// if (\"2\".equals(temp)) &#123;// a.remove(temp);// &#125;// &#125; Iterator&lt;String&gt; it = a.iterator(); while (it.hasNext()) &#123; String temp = it.next(); if (\"1\".equals(temp)) &#123;//不论是1,2都正常 it.remove(); &#125; &#125; System.out.println(a.toString()); &#125;&#125; 为什么用foreach的时候，1没问题，2出错了呢？先从报错看异常是怎么出来的。由报错可知，是next方法中调用checkForComodification出错。 所以是modeCount !=expectedModCount导致的。 foreach是通过Iterable接口在序列中进行移动。 这里在foreach处打断点，进入可以知道： 赋值给temp的时候先new Itr()(仅第一次)，Itr对象再hasNext()判断，接着再调用next()赋值。 expectedModCount是初始化(此时生成一个Iterator对象)的时候被赋值的。而modCount又是AbstractList的变量。 每次调用list的add/remove的时候，modCount++，而这时它并没有传递给expectedModCount。 当第一次remove掉”2”后，modCount改变 ，for(String temp:a)的时候，会调用ArrayList$Itr.next()方法，next方法会检查modCount是否等于expectedModCount，所以用foreach的时候remove 2出错了。 foreach的时候remove 1没出错呢？稍微改下代码:1234567891011List&lt;String&gt; a = new ArrayList&lt;String&gt;(); a.add(\"1\"); a.add(\"2\"); int n=0; for (String temp : a) &#123;//正常,但是n为1，说明只有一次 n++;// System.out.println(n);//只输出1次:1 if (\"1\".equals(temp)) &#123; a.remove(temp); &#125; &#125; 输出结果:121[2] 可见,foreach 只执行了一次循环。 是什么导致本该两次的循环只进入了一次？之前说到foreach赋值的时候，会先先用hasNext判断。cursor！=size才进入循环体。这里的cursor指的是当前元素的index。循环体进入一次后，remove掉”1”，此时size由2变成了1，cursor也由于next后变为1。再次 for (String temp : a)的时候先调用hasNext因为其相等，所以不再进入循环体。 remove后size–: next后,cursor+1: hasNext比较 为什么直接用Iterator的remove是正常的？a.iterator()直接return new Itr()，Itr 实现了Iterator。我们看看Itr的remove方法： 这里明显看出当它remove后， 马上把modCount的值赋值到了expectedModCount上，所以不会出现list.remove那样报ConcurrentModificationException 。 当然如果并发操作，需要对 Iterator 对象加锁。 感谢阿里巴巴的Java规约~","tags":[{"name":"java","slug":"java","permalink":"http://yoursite.com/tags/java/"}]},{"title":"开始使用hexo","date":"2017-02-13T15:40:41.000Z","path":"2017/02/13/开始使用hexo/","text":"被hexo的简洁、方便吸引。 今后会在这里记录我的点点滴滴。 谢谢。","tags":[{"name":"杂谈","slug":"杂谈","permalink":"http://yoursite.com/tags/杂谈/"}]},{"title":"hexo命令报错","date":"2017-02-13T15:29:49.020Z","path":"2017/02/13/hexo错误/","text":"1YAMLException: end of the stream or a document separator is expected at line 26, column 1: 报错的行根本没有错。用排除法逐一删掉，再hexo g，结果发现是 作横线的 “———-“ 后面少了一个空格的原因,改成”———- “就好了。","tags":[{"name":"hexo","slug":"hexo","permalink":"http://yoursite.com/tags/hexo/"}]}]